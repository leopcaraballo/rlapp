# Branch Protection Rules Configuration
# For GitHub: Settings → Branches → Add Rule
# For GitLab: Settings → Repository → Protected Branches

develop:
  required_status_checks:
    - build
    - test (coverage >= 90%)
    - domain-tests (coverage >= 95% financial)
    - sast (SonarQube: 0 critical)
    - sca (Snyk: 0 critical dependencies)
    - container-scan (Trivy: 0 critical CVEs)
    - secrets-scan (0 hardcoded credentials)

  required_reviews: 2
  require_signed_commits: true
  require_code_owner_reviews: false

  dismiss_stale_reviews: false
  require_update_before_merge: true
  require_conversation_resolution: true

  auto_delete_head_branch: true
  allow_force_pushes: false
  allow_deletions: false

  restrictions:
    users: [] # No user restrictions
    teams: ["dev-team", "architects"] # Dev team can push to branch protection config

qa:
  required_status_checks:
    - build
    - test (coverage >= 90%)
    - sast (SonarQube: 0 critical)
    - sca (Snyk: 0 critical)
    - e2e-tests (all passing)
    - performance-baseline (< 5% deviation)
    - security-scan (0 critical issues)

  required_reviews: 2 # CCB members required
  require_signed_commits: true
  require_code_owner_reviews: true

  dismiss_stale_reviews: false
  require_update_before_merge: true

  auto_delete_head_branch: false
  allow_force_pushes: false
  allow_deletions: false

main:
  required_status_checks:
    - build
    - test (coverage >= 90%)
    - domain-tests (coverage >= 95% financial)
    - sast (SonarQube: 0 critical)
    - sca (Snyk: 0 critical)
    - container-scan (Trivy: 0 critical)
    - secrets-scan (0 hardcoded)
    - security-scan (CISO approved)

  required_reviews: 2 # CCB required
  require_signed_commits: true
  require_code_owner_reviews: true
  require_status_checks: true

  dismiss_stale_reviews: false
  require_update_before_merge: true
  require_conversation_resolution: true

  auto_delete_head_branch: false
  allow_force_pushes: false # CRITICAL: Never allow force push on production
  allow_deletions: false # CRITICAL: Prevent branch deletion

  restrictions:
    users: [] # No direct pushes allowed
    teams: ["cto-team", "security-team"] # Only CCB can execute merges
